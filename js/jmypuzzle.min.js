!function(a){function b(b,c){return parseInt(a.css(b[0],c))||0}function c(a){return a[0].offsetWidth+b(a,"marginLeft")+b(a,"marginRight")}a.fn.jMyPuzzle=function(b){return b=a.extend({answer:"7,2,1,3,8,5,6,4",maxTrials:3,classOnValid:"valid",classOnNotValid:"notValid",classOnMiValid:"miValid",fnOnCheck:null,ajaxResultUrl:"",fnOnAjax:null,fnOnReset:null,elts:new Array},b||{}),this.each(function(){function d(c,e){if(c>=e.length){var f=e.length,g=(1*u+.5*w)/f*100,h=t,j="";for(i=0;i<f;i++)j+=q[i].initialN+1+",";return j=j.replace(/,+$/,""),jSonResults={nb_words:f,nb_valid:u,nb_not_valid:v,nb_mi_valid:w,success_rate:g,trial_nb:h,max_trials:b.maxTrials,answer:j},null!==b.fnOnCheck?b.fnOnCheck(jSonResults):void(""!==b.ajaxResultUrl&&a.post(b.ajaxResultUrl,jSonResults,function(a){null!==b.fnOnAjax&&b.fnOnAjax(a)}))}q[c].removeClass(b.classOnValid+" "+b.classOnMiValid+" "+b.classOnNotValid);var k=parseInt(q[c].pos.top);return q[c].animate({top:k+7+"px"},{duration:75,complete:function(){if(q[c].initialN+1==e[c])q[c].addClass(b.classOnValid),u++;else if(q[c+2]&&b.answer.indexOf(q[c].initialN+1+","+(q[c+1].initialN+1)+","+(q[c+2].initialN+1))>=0){var a=0;for(a=0;a<e.length&&q[c].initialN+1!=e[a];a++);for(var d=0;d<e.length;d++){if(!q[c+d]||e[d+a]!=q[c+d].initialN+1)return void(c+=d-1);d>0?q[c+d].animate({top:k+7+"px"},75).addClass(b.classOnMiValid).animate({top:k+"px"},100):q[c+d].addClass(b.classOnMiValid),w++}}else q[c].addClass(b.classOnNotValid),v++}}).animate({top:k+"px"},{duration:100,complete:function(){return d(c+1,e)}})}function e(a,b,c,d){var e=null!==this.eltPos?this.eltPos:f(c);if(this.eltPos=f(c),!e||this.eltPos.left!=e.left)if(n=e&&this.eltPos.left>e.left?o:p,n==o){if(c.n<d.length-1){var g=d[c.n+1],h=g.pos.left+parseInt(g.outerWidth/2);this.eltPos.left+c.outerWidth>h&&(c.insertAfter(g),g.pos.left=c.pos.left,c.pos.left+=g.outerWidth,d[c.n]=g,d[c.n+1]=c,d[c.n].n=c.n,c.n=c.n+1,g.animate({left:g.pos.left+"px"},300))}}else if(n==p&&c.n>0){var i=d[c.n-1],j=i.pos.left+parseInt(i.outerWidth/2);this.eltPos.left<j&&(c.insertBefore(i),c.pos.left=i.pos.left,i.pos.left+=c.outerWidth,d[c.n]=i,d[c.n-1]=c,d[c.n].n=c.n,c.n=c.n-1,i.animate({left:i.pos.left+"px"},300))}}function f(a){return{left:parseInt(a.css("left")),top:"auto"==a.css("top")?0:parseInt(a.css("top"))}}function g(){m=0,l.each(function(){a(this).css("left",m+"px"),m+=c(a(this)),a(this).removeClass(b.classOnValid+" "+b.classOnMiValid+" "+b.classOnNotValid),a(this).addClass("normal")})}var h=a(this),k=a("ul",h),l=a("li",k),m=0,n=null,o=1,p=2;this.elts=new Array(l.size());var q=this.elts,r=0,s=0,t=0,u=0,v=0,w=0;k.css({display:"block",position:"absolute"}),l.css({"float":"left","list-style-type":"none",display:"block",position:"absolute"}),b.maxTrials>0&&a(".trials").length&&a(".trials").html("0/"+b.maxTrials),l.each(function(){s+=c(a(this))}),k.css({width:s,height:l.height()+parseInt(l.css("marginTop"))+parseInt(l.css("marginBottom"))+2*parseInt(l.css("paddingBottom"))+2*parseInt(l.css("paddingTop"))+"px"}),k.css("left",h.offset().left+(h.width()-s)/2),g(),l.each(function(){var b=a(this);b.outerWidth=c(a(this)),b.pos=f(b),b.initialN=r,b.n=r,b.draggable({containment:h,drag:function(a,c){e(a,c,b,q)},start:function(){var a=q[b.n];a.css({opacity:.4,"z-index":200})},stop:function(){var a=q[b.n];a.css({opacity:1,"z-index":5}),a.animate({left:a.pos.left,top:a.pos.top},300)}}),q[r++]=b}),a(".check").length&&a(".check").click(function(){if(u=0,v=0,w=0,b.maxTrials>0){if(t>=b.maxTrials)return;t++,a(".trials").html(t+"/"+b.maxTrials)}var c=b.answer.split(",");return c.length!=l.size()&&alert("error - answer doesn't match !"),d(0,c)}),a(".reset").length&&a(".reset").click(function(){var a=l.size();for(i=0;i<a;i++)if(q[i].initialN!=i)for(j=i;j<a;j++)if(q[j].initialN==i){var c=q[i];q[i]=q[j],q[i].n=i,q[i].insertBefore(q[i+1]),q[j]=c,q[j].n=j,j+1<a?q[j].insertBefore(q[j+1]):q[j].insertAfter(q[j-1]);break}for(g(),i=0;i<a;i++)q[i].pos=f(q[i]);b.fnOnReset()})})}}(jQuery);